
/*!
 * Queiroz.js 2.8.0
 * JavaScript Extension for Dimep Kairos
 * https://github.com/viniciusknob/queiroz.js
 */

!function(e){var i={name:"Queiroz.js",version:"2.8.0",pl:{}};e.Queiroz=i}(window),function(e,i){var n=function(){return{backWeek:function(){e.mudarSemana(-1,!0)},nextWeek:function(){e.mudarSemana(1,!0)}}}();i.pl.kairos=n}(window,Queiroz),function(e){var i={DIV:"div",P:"p",SPAN:"span",STRONG:"strong"},n=function(){var e=function(e,i,n){var t=document.createElement(e);if(i&&(t.className=i),n){var a=document.createTextNode(n);t.appendChild(a)}return t},n=function(n,t,a){var r=e(i.SPAN,"qz-box qz-box-muted",n),o=e(i.STRONG,a,t);return r.appendChild(o),r};return{STYLE:"<style>strong{font-weight:700}#SemanaApontamentos{cursor:default!important}.ContentTable{margin-top:inherit}.FilledSlot,.LastSlot,.emptySlot{height:inherit;padding:5px}.FilledSlot span{margin:inherit!important}.qz-text-primary{color:brown}.qz-text-golden{color:#b8860b}.qz-text-green{color:green}.qz-text-teal{color:teal}.qz-box{padding:5px 10px;margin:5px 1px;border:#a9a9a9 1px solid}.qz-box-head{float:right;padding:10px 0}.qz-box-muted{background-color:#d3d3d3}.qz-box .qz-box-content{vertical-align:middle}.qz-help-text{font-size:10px}</style>",header:function(){return e(i.P,"qz-box-head")},headerLastWeekModeOn:function(){return n("","SEMANA ANTERIOR","qz-text-primary")},headerLaborTime:function(e){return n("Efetuado: ",e,"qz-text-green")},headerBalanceTime:function(e){return n("Saldo: ",e,"qz-text-teal")},headerWeekPendingTime:function(e){return n("Pendente: ",e,"qz-text-primary")},headerExtraTime:function(e){return n("Extra: ",e,"qz-text-green")},headerWeekTimeToLeave:function(e){return n("Saída: ",e,"qz-text-primary")},balanceTimePerDay:function(n){var t=e(i.DIV,"qz-help-text","Saldo"),a=e(i.STRONG,"qz-box-content qz-text-teal",n),r=e(i.DIV,"qz-box qz-box-muted");return r.appendChild(t),r.appendChild(a),r},laborTimePerDay:function(n){var t=e(i.DIV,"qz-help-text","Efetuado"),a=e(i.STRONG,"qz-box-content qz-text-green",n),r=e(i.DIV,"qz-box qz-box-muted");return r.appendChild(t),r.appendChild(a),r},laborTimePerShift:function(n,t){var a=e(i.DIV,"qz-box qz-box-muted"),r=e(i.STRONG,"qz-box-content",n);if(!t){var o=e(i.DIV,"qz-help-text","Trabalhando...");a.appendChild(o),r.classList.add("qz-text-golden")}return a.appendChild(r),a},todayTimeToLeave:function(n){var t=e(i.DIV,"qz-help-text","Saída"),a=e(i.STRONG,"qz-box-content qz-text-primary",n),r=e(i.DIV,"qz-box qz-box-muted");return r.appendChild(t),r.appendChild(a),r}}}();e.pl.snippet=n}(Queiroz),function(e,i){var n=function(){return{append:function(i,n){var t=this;t.asyncReflow(function(){var a=t.get(i),r=e.createElement("div");"string"==typeof n?r.innerHTML=n:r.appendChild(n),a.appendChild(r)})},asyncReflow:function(e){setTimeout(e,25)},get:function(i,n){return(n||e).querySelector(i)},getAll:function(i,n){return(n||e).querySelectorAll(i)}}}();i.pl.view=n}(document,Queiroz),function(e){var i=function(){var e=function(e){return e<10?"0"+e:e};return{zero:"00:00",fake:"12:34",dateToHuman:function(i){return e(i.getHours())+":"+e(i.getMinutes())},millisToHuman:function(i){var n=parseInt(i/36e5),t=parseInt(i/6e4%60);return e(n)+":"+e(t)},diff:function(e,i){return e instanceof Date&&i instanceof Date?i.getTime()-e.getTime():i-e},hourToMillis:function(e){return 36e5*e},minuteToMillis:function(e){return 6e4*e},isToday:function(e){var i=new Date;return e.getDate()===i.getDate()&&e.getMonth()===i.getMonth()&&e.getFullYear()===i.getFullYear()},toDate:function(e){var i=e.split(" "),n=i[0].split("_"),t=i[1].split(":");return new Date(n[2],n[1]-1,n[0],t[0],t[1])},Weekday:{SUNDAY:0,MONDAY:1,TUESDAY:2,WEDNESDAY:3,THURSDAY:4,FRIDAY:5,SATURDAY:6}}}();e.pl.time=i}(Queiroz),function(e){var i=function(){return{textFormat:function(e,i){for(var n=0;n<i.length;n++){var t=new RegExp("\\{"+n+"\\}","g");e=e.replace(t,i[n])}return e}}}();e.pl.util=i}(Queiroz),function(e){var i=e.pl.kairos;View=e.pl.view,Time=e.pl.time,Util=e.pl.util,Snippet=e.pl.snippet;var n={INITIAL_WEEKDAY:Time.Weekday.MONDAY,LAST_WEEK_MODE:!1,MAX_CONSECUTIVE_HOURS_PER_DAY:6,MAX_HOURS_PER_WEEK:44,MAX_MINUTES_PER_DAY:528,USERSCRIPT_DELAY_MILLIS:1e3},t={COLUMN_DAY:".DiaApontamento",CHECKPOINT:".FilledSlot span",DATE:"[id^=hiddenDiaApont]",HEADER:"#SemanaApontamentos div",TIME_IN:".TimeIN,.TimeINVisualizacao"},a=function(){return Time.hourToMillis(n.MAX_HOURS_PER_WEEK)},r=function(){return Time.hourToMillis(n.MAX_CONSECUTIVE_HOURS_PER_DAY)},o=function(){return Time.minuteToMillis(n.MAX_MINUTES_PER_DAY)},l={week:{laborTime:{millis:0,human:"",html:""},balanceTime:{millis:0,human:"",html:""},pendingTime:{millis:0,human:"",html:""},extraTime:{millis:0,human:"",html:""},_computePendingTimeInMillis:function(){return a()-this.laborTime.millis},_computeExtraTimeInMillis:function(){return this.laborTime.millis-a()},_buildHumanBalanceTime:function(){var e=this.balanceTime.millis;return 0==e?Time.zero:e>0?"+"+Time.millisToHuman(e):e<0?"-"+Time.millisToHuman(-1*e):void 0},buildTime:function(){this.pendingTime.millis=this._computePendingTimeInMillis(),this.extraTime.millis=this._computeExtraTimeInMillis()},buildHumanTime:function(){this.laborTime.human=Time.millisToHuman(this.laborTime.millis),this.balanceTime.human=this._buildHumanBalanceTime(),this.pendingTime.human=Time.millisToHuman(this.pendingTime.millis>0?this.pendingTime.millis:0),this.extraTime.human=Time.millisToHuman(this.extraTime.millis>0?this.extraTime.millis:0)},buildHtmlTime:function(){this.laborTime.html=Snippet.headerLaborTime(this.laborTime.human),this.balanceTime.html=Snippet.headerBalanceTime(this.balanceTime.human),this.pendingTime.html=Snippet.headerWeekPendingTime(this.pendingTime.human),this.extraTime.html=Snippet.headerExtraTime(this.extraTime.human)}},today:{laborTime:{millis:0}}},m="",u=function(e){return View.getAll(t.CHECKPOINT,e)},T=function(e){return View.get(t.DATE,e).value},d=function(){if(l.week.pendingTime.millis<=0)return"";if(l.week.pendingTime.millis>o())return"";var e="";if(m){var i=m.getTime()+l.week.pendingTime.millis;if(!i||i<(new Date).getTime())return"";var n=Time.dateToHuman(new Date(i));e=Snippet.headerWeekTimeToLeave(n)}return e},p=function(){return l.week.pendingTime.millis>=0?l.week.pendingTime.html:l.week.extraTime.html},s=function(e){var i=Snippet.header();return e.forEach(function(e){e&&i.appendChild(e)}),i},c=function(){l.week.buildHumanTime(),l.week.buildHtmlTime();var e=n.LAST_WEEK_MODE?Snippet.headerLastWeekModeOn():"",i=p(),a=d(),r=[e,l.week.laborTime.html,l.week.balanceTime.html,i,a],o=s(r);View.append(t.HEADER,o)},h=function(){"ON"===n.LAST_WEEK_MODE&&(n.LAST_WEEK_MODE="DOING"),l.week.buildTime(),"DOING"!==n.LAST_WEEK_MODE&&c()},f=function(e,i,n){i<0&&(i=0);var t=Time.millisToHuman(i),a=Snippet.laborTimePerShift(t,n);document.createElement("div").appendChild(a);var r=e.parentNode;r.parentNode.insertBefore(a,r.nextSibling)},E=function(e,i){var n=Time.millisToHuman(i);e.appendChild(Snippet.laborTimePerDay(n))},S=function(e,i){var n=Time.isToday(Time.toDate(T(e)+" "+Time.fake)),t=o(),a=0,r=Time.zero;i<t?(a=t-i,r="-"+Time.millisToHuman(a),0==n&&(l.week.balanceTime.millis-=a)):i>t&&(a=i-t,r="+"+Time.millisToHuman(a),0==n&&(l.week.balanceTime.millis+=a)),0==n&&e.appendChild(Snippet.balanceTimePerDay(r))},D=function(e,i){var n=o()-l.today.laborTime.millis,t=i+(n<0?0:n),a=Time.dateToHuman(new Date(t)),r=Snippet.todayTimeToLeave(a),m=e.parentNode;m.parentNode.insertBefore(r,m.nextSibling)},b=function(e){var i=u(e);if(i.length){var d=0;View.getAll(t.TIME_IN,e).forEach(function(t,u){var p=t.textContent,s=Time.toDate(T(e)+" "+p),c=i[2*u+1];if(c&&!c.parentElement.classList.contains("LastSlot")){var h=c.textContent,E=Time.toDate(T(e)+" "+h),S=Time.diff(s,E);d+=S,"DOING"!==n.LAST_WEEK_MODE&&f(c,S,!0),Time.isToday(s)&&(l.today.laborTime.millis+=S)}else{m=s,Time.isToday(s)&&a()-l.week.laborTime.millis>o()&&D(t,s.getTime());var b=Time.diff(s,new Date);b<r()&&f(t,d+b,!1)}}),d>0&&(l.week.laborTime.millis+=d,E(e,d)),S(e,d)}},x=function(){var e=[],i=!1;return View.getAll(t.COLUMN_DAY).forEach(function(t){var a=T(t)+" "+Time.fake,r=Time.toDate(a);0===l.week.laborTime.millis?(i||(i=r.getDay()===n.INITIAL_WEEKDAY))&&e.push(t):r.getDay()===n.INITIAL_WEEKDAY?n.LAST_WEEK_MODE="DONE":"DOING"===n.LAST_WEEK_MODE&&e.push(t)}),e},g=function(){View.append("head",Snippet.STYLE),x().forEach(b),h(),"DOING"===n.LAST_WEEK_MODE&&(i.nextWeek(),setTimeout(v,1e3))},v=function(){var e=setInterval(function(){View.get(t.CHECKPOINT)&&(clearInterval(e),g())},n.USERSCRIPT_DELAY_MILLIS)};e.bless=function(e){return n.LAST_WEEK_MODE=!!e&&"ON","ON"===n.LAST_WEEK_MODE?(i.backWeek(),setTimeout(v,1e3)):View.get(t.CHECKPOINT)?g():v(),this.name+" "+this.version}}(Queiroz),Queiroz.bless();